# QwikXP Messenger API v4.0

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π backend –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ QwikXP —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite, JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ WebSocket –¥–ª—è —á–∞—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npx prisma migrate dev

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
npm start
```

       –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ `http://qwicxp.com` (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)

## ‚ú® –§—É–Ω–∫—Ü–∏–∏ v4.0

- **üóÑÔ∏è SQLite –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - Prisma ORM –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- **üîê JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
- **üîí –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - bcrypt –¥–ª—è –∑–∞—â–∏—Ç—ã
- **üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≤—Ö–æ–¥, –ø—Ä–æ—Ñ–∏–ª–∏
- **üí¨ –ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–æ–≤, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- **üîå WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **‚å®Ô∏è –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø–µ—á–∞—Ç–∏** - "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç..."
- **üì± –°—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω
- **üõ°Ô∏è –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã** - middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
- **üì± RESTful API** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:
- **User** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- **Chat** - —á–∞—Ç—ã (–ª–∏—á–Ω—ã–µ –∏ –≥—Ä—É–ø–ø–æ–≤—ã–µ)
- **ChatMember** - —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–æ–≤
- **Message** - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö
- **MessageReceipt** - —Å—Ç–∞—Ç—É—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Device** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ú–∏–≥—Ä–∞—Ü–∏–∏:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev --name migration_name

# –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npx prisma studio
```

## üîå WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

       ### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
       ```
       ws://qwicxp.com?token=YOUR_JWT_TOKEN
       ```

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:

#### –û—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:
- `typing_start` - –Ω–∞—á–∞–ª–æ –ø–µ—á–∞—Ç–∏
- `typing_stop` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—á–∞—Ç–∏
- `message_read` - —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
- `user_status` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

#### –û—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É:
- `connection_established` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `new_message` - –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
- `typing_start` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å
- `typing_stop` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –ø–µ—á–∞—Ç–∞—Ç—å
- `message_read` - —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
- `user_status` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `new_chat` - —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —á–∞—Ç
- `user_added` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket:
–û—Ç–∫—Ä–æ–π—Ç–µ `websocket-test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è WebSocket —Ñ—É–Ω–∫—Ü–∏–π.

## üîó –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- `GET /` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API
- `GET /health` - —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
- `GET /api/test` - —Ç–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç
- `POST /api/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/auth/login` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω)
- `GET /api/users` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GET /api/users/profile` - –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/chats` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
- `GET /api/chats` - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/chats/:chatId/messages` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- `GET /api/chats/:chatId/messages` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
- `GET /api/websocket/token` - –ø–æ–ª—É—á–µ–Ω–∏–µ WebSocket URL
- `GET /api/websocket/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```bash
POST /api/auth/register
Content-Type: application/json

{
  "username": "newuser",
  "email": "user@example.com",
  "password": "securepassword",
  "displayName": "–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
}
```

### –í—Ö–æ–¥
```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "newuser",
  "password": "securepassword"
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```bash
GET /api/users
Authorization: Bearer YOUR_JWT_TOKEN
```

## üí¨ –ß–∞—Ç—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
```bash
POST /api/chats
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: application/json

{
  "isGroup": false,
  "memberIds": ["user_id_1", "user_id_2"]
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
```bash
POST /api/chats/CHAT_ID/messages
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: application/json

{
  "content": "–ü—Ä–∏–≤–µ—Ç!",
  "type": "TEXT"
}
```

## üîå WebSocket API

### –ü–æ–ª—É—á–µ–Ω–∏–µ WebSocket URL
```bash
GET /api/websocket/token
Authorization: Bearer YOUR_JWT_TOKEN
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```bash
GET /api/websocket/stats
Authorization: Bearer YOUR_JWT_TOKEN
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞
```bash
       curl http://qwicxp.com/health
```

### 2. –¢–µ—Å—Ç API
```bash
       curl http://qwicxp.com/api/test
```

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
       curl -X POST http://qwicxp.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"testpass","displayName":"–¢–µ—Å—Ç"}'
```

### 4. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
```bash
       curl -X POST http://qwicxp.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"testpass"}'
```

### 5. –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞
```bash
       curl -X POST http://qwicxp.com/api/chats \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"isGroup":false,"memberIds":["other_user_id"]}'
```

### 6. WebSocket —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–û—Ç–∫—Ä–æ–π—Ç–µ `websocket-test.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
nova_api/
‚îú‚îÄ‚îÄ index.js              # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ websocket-service.js  # WebSocket —Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ websocket-test.html   # –¢–µ—Å—Ç WebSocket
‚îú‚îÄ‚îÄ package.json          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .gitignore            # Git –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma     # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ migrations/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îî‚îÄ‚îÄ qwikxp.db            # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js** - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **Express.js** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Prisma** - ORM –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **SQLite** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **WebSocket (ws)** - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **JWT** - JSON Web Tokens –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **bcryptjs** - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **CORS** - –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [x] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite + Prisma) ‚úÖ
- [x] WebSocket –¥–ª—è —á–∞—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ ‚úÖ
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –º–µ–¥–∏–∞
- [ ] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (FCM)
- [ ] E2EE —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã –∏ —Ä–æ–ª–∏

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
